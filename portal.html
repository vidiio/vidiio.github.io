<!DOCTYPE html>
<html data-ember-extension="1">
<!--<![endif]-->

<head>
  <meta charset="utf-8">

  <title>Vidiio</title>

  <script type="text/javascript" src="./assets/pd.js"></script>
  <script type="text/javascript" async="" src="./assets/inpage_linkid.js" id="undefined"></script>
  <script type="text/javascript" async="" src="./assets/bf.min.js"></script>
  <script type="text/javascript" async="" src="./assets/ga.js"></script>
  <script src="./assets/30715011.js"></script>
</head>

<body id="app" class="satemplate" data-ember-extension="1">
  <div id="player1"></div>

  <input type="text" id="url">

  <script src="./assets/pubnub.min.js"></script>
  <script src="./assets/main.js"></script>
  <script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script src="./videosync.js"></script>

  <script>
    var vidid = 'A9HV5O8Un6k';

    $('#url').focus(function() {
      player1.pauseVideo();
    });

    $('#url').keypress(function(e) {
      if(e.keyCode == 13) {
        var match = $('#url').val().match(/[?&]v=([^&]+)/);
        vidid = match[1];
        player1.loadVideoById(vidid);
      }
    });

    var tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    var playerVars = {
      modestbranding: 1,
      theme: 'light',
      showinfo: 0,
      rel: 0,
      fs: 0
    };

    var user = localstorage.getItem('user'); // set username
    var vidSync1 = new VideoSync(localstorage.getItem('room'), user);
    var player1;

    function onYouTubeIframeAPIReady() {
      player1 = new YT.Player('player1', {
        height: '390',
        width: '640',
        videoId: vidid,
        playerVars: playerVars,
        events: {
          'onReady': vidSync1.onPlayerReady,
          'onStateChange': vidSync1.onPlayerStateChange
        }
      });
    }

    var pubnub = PUBNUB.init({
      publish_key: 'pub-c-8ca801fc-d70a-4a96-b09a-250ca597a6e9',
      subscribe_key: 'sub-c-09c251d0-a40f-11e4-a3fb-0619f8945a4f',
      uuid: user
    });

    pubnub.subscribe({
      channel: localstorage.getItem('room'),
      callback: consolePrint
    });
  </script>
</body>

</html>
