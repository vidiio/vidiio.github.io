<!DOCTYPE html>
<html data-ember-extension="1">
<!--<![endif]-->

<head>
  <meta charset="utf-8">

  <title>Vidiio</title>

  <script type="text/javascript" src="./assets/pd.js"></script>
  <script type="text/javascript" async="" src="./assets/inpage_linkid.js" id="undefined"></script>
  <script type="text/javascript" async="" src="./assets/bf.min.js"></script>
  <script type="text/javascript" async="" src="./assets/ga.js"></script>
  <script src="./assets/30715011.js"></script>
</head>

<body id="app" class="satemplate" data-ember-extension="1">
  <div id="player1"></div>

  <input type="text" id="url">

  <h2>Enter Chat and Press Enter</h2>
  <div><input id='input' placeholder='you-chat-here' /></div> 
  <h2>Chat Output</h2>
  <div id='box'></div>

  <section id="main">
    <canvas id="drawCanvas" width="300" height="300">Canvas is not supported on this browser!</canvas>

    <section id="colorSwatch">
      <input type="radio" name="color" id="color01" data-color="gold" checked><label for="color01"></label> 
      <input type="radio" name="color" id="color02" data-color="darkorange">  <label for="color02"></label>  
      <input type="radio" name="color" id="color03" data-color="navy">    <label for="color03"></label>  
      <input type="radio" name="color" id="color04" data-color="yellowgreen"> <label for="color04"></label>  
      <input type="radio" name="color" id="color05" data-color="firebrick"> <label for="color05"></label>  
      <input type="radio" name="color" id="color06" data-color="powderblue">  <label for="color06"></label>
      <input type="button" value="clear" id="clear">
    </section>
  </section>

  <script src="./assets/pubnub.min.js"></script>
  <script src="./assets/main.js"></script>
  <script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script src="./videosync.js"></script>
  <script src="./app.js"></script>
  <script>
    var vidid = 'A9HV5O8Un6k';

    $('#url').focus(function() {
      player1.pauseVideo();
    });

    $('#url').keypress(function(e) {
      if(e.keyCode == 13) {
        var match = $('#url').val().match(/[?&]v=([^&]+)/);
        vidid = match[1];
        player1.loadVideoById(vidid);
      }
    });

    var tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    var playerVars = {
      modestbranding: 1,
      theme: 'light',
      showinfo: 0,
      rel: 0,
      fs: 0
    };

    //var user = sessionStorage.user; // set username
    var user ="asdf" + Math.random().toString();
    //var vidSync1 = new VideoSync(sessionStorage.room, user);
    var vidSync1 = new VideoSync("demo", user);
    var player1;

    function onYouTubeIframeAPIReady() {
      player1 = new YT.Player('player1', {
        height: '390',
        width: '640',
        videoId: vidid,
        playerVars: playerVars,
        events: {
          'onReady': vidSync1.onPlayerReady,
          'onStateChange': vidSync1.onPlayerStateChange
        }
      });
    }

    var pubnub = PUBNUB.init({
      publish_key: 'pub-c-8ca801fc-d70a-4a96-b09a-250ca597a6e9',
      subscribe_key: 'sub-c-09c251d0-a40f-11e4-a3fb-0619f8945a4f',
      uuid: user
    });

    (function(){
      var box = PUBNUB.$('box');
      var input = PUBNUB.$('input');
      var channel = 'demo';

      PUBNUB.subscribe({
        channel  : channel,
        callback : function(m) { 
          box.innerHTML = ('' + m.text.user + ": " + m.text.chat).replace( /[<>]/g, '' ) + '<br>' + box.innerHTML 
        }
      });
      PUBNUB.bind( 'keyup', input, function(e) {
        (e.keyCode || e.charCode) === 13 && PUBNUB.publish({
            channel : channel, 
            message : { 
              text: {
                chat: input.value,
                user: user
              }
            }, 
            x : (input.value='')
        })
      } )
    })();

    PUBNUB.publish({ 
      channel : 'demo',
      message : { 
        text: {
          chat: 'hello!',
          user: user
        }
      } 
    })

    $(window).on('beforeunload', function(){
      PUBNUB.publish({ 
      channel : 'demo',
        message : { 
          text: {
            chat: 'goodbye!',
            user: user
          }
        } 
      })
    });
  </script>
</body>

</html>
